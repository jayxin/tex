\ProvidesPackage{style}

% GEOMETRY {{{

% Golden ratio proportions on crown quarto with marginpar inside
%\RequirePackage[includemp,
			%paperwidth=18.90cm,
			%paperheight=24.58cm,
			%top=2.170cm,
			%bottom=3.510cm,
			%inner=2.1835cm,
			%outer=2.1835cm,
			%marginparwidth=4cm, % Fixed for now
			%marginparsep=0.4cm]{geometry}

% For full bleed printing on crown quarto with 1/8 inch trim margin
% \RequirePackage[includemp,
%             paperwidth=19.54cm,
%             paperheight=25.22cm,
%             % showframe,
%             layoutwidth=18.90cm,
%             layoutheight=24.58cm,
%             layouthoffset=0.32cm,
%             layoutvoffset=0.32cm,
%             top=2.170cm,
%             bottom=3.510cm,
%             inner=2.1835cm,
%             outer=2.1835cm,
%             marginparwidth=4cm, % Fixed for now
%             marginparsep=0.4cm]{geometry}

% For printing on A4
\usepackage[
	a4paper,
	paperwidth=21.0cm,
	paperheight=29.7cm,
	%layouthoffset=1.05cm,
	%layoutvoffset=2.56cm,
	top=2.620cm,
	bottom=4.238cm,
	inner=2.183cm,
	outer=2.183cm,
	marginparwidth=4.830cm, % Fixed for now
	marginparsep=0.483cm,
	includemp
]{geometry}

\newcommand{\marginpage}{
	\newgeometry{
		top=2.620cm,
		bottom=4.238cm,
		inner=2.183cm,
		outer=2.183cm,
		marginparwidth=4.830cm,
		marginparsep=0.483cm,
		includemp
	}
}

\newcommand{\widepage}{
	\newgeometry{
		top=2.620cm,
		bottom=4.238cm,
		inner=2.1835cm,
		outer=2.1835cm,
		marginparwidth=0cm,
		marginparsep=0cm,
		ignoremp
	}
}

\newcommand{\fullwidthpage}{
	\newgeometry{
		top=0cm,
		bottom=0cm,
		inner=0cm,
		outer=0cm,
		marginparwidth=0cm,
		marginparsep=0cm,
		ignoremp
	}
}

% }}}

% FONTS {{{

\RequirePackage{ifxetex}		% Detect if we are using XeLaTeX

\ifxetex
  \RequirePackage{polyglossia}			% Correct hyphenation
  \RequirePackage[english=british]{csquotes}	% English quotes
  \setdefaultlanguage{english}
  \RequirePackage{fontspec}				% Selecting fonts

  \geometry{xetex}

  \setmainfont{texgyrepagella-regular.otf}[
	Ligatures=TeX,
	Numbers=Lining,
	BoldFont=texgyrepagella-bold.otf,
	ItalicFont=texgyrepagella-italic.otf,
	BoldItalicFont=texgyrepagella-bolditalic.otf,
  ]
  \setmonofont{Nimbus Mono PS}[
	%Path=../fonts/,
	Scale=MatchLowercase,
	%BoldFont=CourierPrime-Bold,
	%ItalicFont=CourierPrime-Italic,
	%BoldItalicFont=CourierPrime-BoldItalic,
  ]

  \newfontfamily\fanciestfont[
	%Path=../fonts/,
	Ligatures={TeX,Discretionary},
	%Scale=MatchLowerCase,
  ]{Cantarell}
  \newfontfamily\fancyfont[
	%Path=../fonts/,
	Ligatures=TeX,
  ]{Cantarell}
  \newfontfamily\chapternumberfont[
	%Path=../fonts/,
	Ligatures=TeX,
	Numbers=Lining
  ]{Cantarell}

  \addtokomafont{disposition}{\fancyfont}
  \addtokomafont{part}{\Huge}
  \addtokomafont{title}{\fanciestfont}
  \addtokomafont{chapter}{\fanciestfont}
  \addtokomafont{chapterentry}{\normalfont\scshape}
  \addtokomafont{descriptionlabel}{\normalfont\bfseries}
  \addtokomafont{caption}{\footnotesize}

\else
  \RequirePackage[english]{babel}	% Load characters and hyphenation
  \RequirePackage[english=british]{csquotes}	% English quotes
  \RequirePackage[T1]{fontenc}		% utf8 encoding in the output (.pdf) file
  \RequirePackage{fourier}
  \usepackage[scaled=1]{helvet}


  %\addtokomafont{disposition}{\rmfamily\normalfont\itshape}
  %\addtokomafont{title}{\normalfont\itshape}
  \addtokomafont{part}{\normalfont\itshape}
  \addtokomafont{chapter}{\normalfont\itshape}
  \addtokomafont{section}{\normalfont\itshape}
  \addtokomafont{subsection}{\normalfont\itshape}
  \addtokomafont{subsubsection}{\normalfont\itshape}
  \addtokomafont{paragraph}{\normalfont\bfseries}
  \addtokomafont{partentry}{\normalfont\scshape\bfseries}
  \addtokomafont{chapterentry}{\normalfont\bfseries}
  %\setkomafont{descriptionlabel}{\normalfont\bfseries}
  %\addtokomafont{caption}{\footnotesize}
  %\makeatletter
  %\addtokomafont{captionlabel}{\@margin@par}
  %\makeatother

\fi

% }}}

% TOC, LOF AND LOT {{{

% Levels in table of contents
\setcounter{tocdepth}{\sectiontocdepth}

% List of figures title as "Figures"
\renewcaptionname{english}{\listfigurename}{Figures}
\renewcaptionname{english}{\listtablename}{Tables}

% Table of contents styles
%\newlength{\alignviiilength}
%\setlength{\alignviiilength}{7.5mm}
%\newlength{\alignxlength}
%\setlength{\alignxlength}{8.5mm}
%\renewcommand{\cftdotsep}{\cftnodots}
%\renewcommand{\cftpnumalign}{l}

%\setlength{\cftpartnumwidth}{\alignviiilength}
%\renewcommand{\cftpartfont}{\LARGE\hypersetup{allcolors=black}}
%\renewcommand{\cftpartpagefont}{\LARGE}

%\setlength{\cftchapnumwidth}{\alignviiilength}
%\renewcommand{\cftchapfont}{\large\hypersetup{allcolors=black}}
%% \renewcommand{\cftchapleader}{\hspace{1em}}
%\renewcommand{\cftchappagefont}{\large}
%% \renewcommand{\cftchapafterpnum}{\cftparfillskip}

%\setlength{\cftsecnumwidth}{\alignviiilength}
%\renewcommand{\cftsecfont}{\hypersetup{allcolors=black}}
%\setlength{\cftsecindent}{\alignviiilength}
%\renewcommand{\cftsecleader}{\hspace{1em}}
%% \renewcommand{\cftsecpagefont}{\normalfont\color{greenforlinks}}
%\renewcommand{\cftsecafterpnum}{\cftparfillskip}

%\setlength{\cftfigindent}{0mm}
%\renewcommand{\cftfigfont}{\hypersetup{allcolors=black}}
%\setlength{\cftfignumwidth}{\alignxlength}
%\renewcommand{\cftfigleader}{\hspace{1em}}
%\renewcommand{\cftfigafterpnum}{\cftparfillskip}

%\setlength{\cfttabindent}{0mm}
%\setlength{\cfttabnumwidth}{\alignxlength}
%\renewcommand{\cfttabfont}{\hypersetup{allcolors=black}}
%\renewcommand{\cfttableader}{\hspace{1em}}
%\renewcommand{\cfttabafterpnum}{\cftparfillskip}

% }}}

% FORMATTING DISPOSITIONS {{{

% Part title style [todo]
%\renewcommand*{\partformat}{\vspace{-6cm}\partname~\thepart\autodot\thispagestyle{empty}}

\renewcommand*{\chapterformat}
{
  \enskip\mbox{\scalebox{4}{\thechapter\autodot}}
}
\renewcommand\chapterlinesformat[3]
{
  \vspace*{-1cm}%
  \parbox[b]{\textwidth}{\hrulefill#2}\par%
  #3%\par\bigskip
  \parbox[b]{\textwidth+\marginparsep+\marginparwidth}{\hrulefill}%
  %\hrule
}

% Chapter title style
%\renewcommand*{\chapterformat}{
  %\hspace{\linewidth}
  %\rule{1pt}{2cm}
  %\hspace{.5\marginparsep}
  %\parbox[b]{\marginparwidth}{\scalebox{3.3}{\usekomafont{chapter}\thechapter\autodot}}
  %\hspace{-\marginparwidth}
  %\hspace{-.5\marginparsep}
  %\hspace{-\linewidth}
  %\hspace{-1.35cm}
%}

%\renewcommand*{\chapterformat}{%
  %\enskip\mbox{\scalebox{4}{\framebox{\thechapter\autodot}}}}
%\renewcommand\chapterlinesformat[3]{%
  %\parbox[b]{\textwidth}{\hrulefill#2}\par%
  %#3\par\bigskip
  %\hrule}

% Might be useful
%\renewcommand{\chapterformat}{
	%\begin{tikzpicture}[remember picture,overlay]
		%\draw[fill=gray,draw=none] (0,0) rectangle (1cm,1cm);
	%\end{tikzpicture}
	%\thechapter
%}

% Chapter title style (old)
% by renewing \@@makechapterhead we lose some KOMA features such as the 
% possibility to set beforeskip in the chapter preamble.
%\setlength{\fboxsep}{0cm}
%\renewcommand*{\@@makechapterhead}[1]{%
  %\vspace*{3\baselineskip plus \parskip}
  %\makebox{%
	%\makebox[\linewidth]{\parbox[c][2cm]{\linewidth}{%
	  %\if@mainmatter\raggedleft\fi\usekomafont{chapter}{#1}%
	%}}%
	%\if@mainmatter%
	  %\makebox[\marginparsep]{\parbox[c][2cm]{%
		%\marginparsep}{\centering\rule{1pt}{2cm}}%
	  %}%
	  %\makebox[\marginparwidth]{\parbox[c][2cm]{\marginparwidth}{%
		%\scalebox{4}{\usekomafont{chapter}\thechapter\autodot}}%
	  %}%
	%\fi
  %}%
  %\vspace*{1.5\baselineskip plus .1\baselineskip minus 
  %.167\baselineskip}
%}

% }}}

% OTHER {{{

%\setglossarystyle{listhypergroup}
\setglossarystyle{listgroup}

% }}}
